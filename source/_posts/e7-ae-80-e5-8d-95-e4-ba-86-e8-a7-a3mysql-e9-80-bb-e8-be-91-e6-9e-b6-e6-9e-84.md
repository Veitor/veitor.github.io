---
title: 简单了解mysql逻辑架构
url: 415.html
id: 415
categories:
  - Mysql
date: 2014-11-30 13:36:31
tags:
---

[![2012031510324452](http://storage.veitor.net/uploads/2014/11/2012031510324452.png)](http://storage.veitor.net/uploads/2014/11/2012031510324452.png) 如图，mysql逻辑架构大致分为三层。 第一层，服务层(为客户端服务)：这并不是mysql所独有的，很多基于网络的客户端/服务器的工具或者服务都有这样的类似架构，比如为请求做连接处理，授权认证，安全等。 第二层，核心层：这是一个比较有意思的部分，大多数mysql核心服务功能都在这一层，包括查询解析、分析、优化、缓存以及所有的内置函数（例如日期、时间、数学和加密函数），所有跨存储引擎的功能都在这一层实现：存储过程、触发器、视图等。 第三层，存储引擎层：存储引擎负责Mysql中数据的存储和提取，每个存储引擎都有它的优势和劣势。服务器（即上面的核心层）通过API与存储引擎进行通信。这些接口屏蔽了不同存储引擎之间的差异，使得这些差异对上层的查询过程透明。存储引擎API包含几十个底层函数，用于执行注入“开始一个事务”或者“根据主键提取一行记录”等操作。但存储引擎不会去解析SQL（InnoDB是一个例外，它会解析外键定义，因为Mysql服务器本身没有实现该功能），不同存储引擎之间也不会相互通信，而只是简单的响应上层服务器的请求。 下面进一步了解第一层和第二层。

> 连接管理与安全性（第一层 服务层）
> =================

![2012031510114191](http://storage.veitor.net/uploads/2014/11/2012031510114191.png)

*   每个客户端链接都会在服务器进程中拥有一个线程，这个链接的查询只会在这个单独的线程中进行，即每个连接的查询都在一个进程中的线程完成。
*   服务层会负责缓存线程，因此不需要为每个新建的连接创建一个线程或销毁已经使用的线程，类似线程池。

### 认证流程

![2012031510220113](http://storage.veitor.net/uploads/2014/11/2012031510220113.png)   当客户端（应用）连接到mysql服务器时，服务器需要对其进行认证。认证基于原始主机信息和密码。如果使用了安全套接字（SSL）的方式连接，还可以使用X.509证书认证。一旦客户端连接成功，服务器会继续验证该客户端是否具有执行某个特定查询的权限。例如，是否允许客户端对world数据库的country数据表执行select语句。

> 优化与执行（第二层 核心层）
> ==============

![2012031510482383](http://storage.veitor.net/uploads/2014/11/2012031510482383.png)  

mysql会解析查询，并创建内部数据结构（解析树），然后对其进行各种优化，包括重写查询、决定表的读取顺序，以及选择合适的索引等。

在解析查询之前，服务器会“询问”是否进行了查询缓存(只能缓存SELECT语句和相应结果)。缓存过的直接返回结果，未缓存的就需要进行解析查询，优化，重新执行返回结果。

参考文献《高性能Mysql》